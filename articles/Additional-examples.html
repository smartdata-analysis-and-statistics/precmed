<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="precmed">
<title>Additional examples • precmed</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Additional examples">
<meta property="og:description" content="precmed">
<meta property="og:image" content="https://smartdata-analysis-and-statistics.github.io/precmed/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">precmed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/Count-examples.html">Example with count outcome</a>
    <a class="dropdown-item" href="../articles/Survival-examples.html">Example with survival outcome</a>
    <a class="dropdown-item" href="../articles/Additional-examples.html">Additional examples</a>
    <a class="dropdown-item" href="../articles/Theoretical-details.html">Theoretical details</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/smartdata-analysis-and-statistics/precmed">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Additional examples</h1>
            <h3 data-toc-skip class="subtitle">Vignette 3 of 4</h3>
            
            <h4 data-toc-skip class="date">May 11, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/smartdata-analysis-and-statistics/precmed/blob/HEAD/vignettes/Additional-examples.Rmd" class="external-link"><code>vignettes/Additional-examples.Rmd</code></a></small>
      <div class="d-none name"><code>Additional-examples.Rmd</code></div>
    </div>

    
    
<!-- badges: start -->
<p><a href="https://cran.r-project.org/package=precmed" class="external-link"><img src="https://www.r-pkg.org/badges/version/precmed" alt="CRAN_Status_Badge"></a> <a href="https://cran.r-project.org/package=precmed" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/last-month/precmed" alt="metacran downloads"></a> <!-- badges: end --></p>
<h1>
precmed: Precision Medicine in R
</h1>
<p>A doubly robust precision medicine approach to estimate and validate
conditional average treatment effects</p>
<div class="section level2">
<h2 id="additional-examples-for-the-precmed-package">Additional examples for the <code>precmed</code> package<a class="anchor" aria-label="anchor" href="#additional-examples-for-the-precmed-package"></a>
</h2>
<p><strong>precmed</strong> can be flexible given the many arguments
that the user can specify. The example described above is one of the
many ways to perform the analysis with most argument values kept as
default. We provide a few more examples below to show what other options
the user has and how to be more creative in using
<strong>precmed</strong>.</p>
</div>
<div class="section level2">
<h2 id="load-required-packages">Load required packages<a class="anchor" aria-label="anchor" href="#load-required-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://smartdata-analysis-and-statistics.github.io/precmed/">precmed</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="additional-examples-with-count-outcomes">Additional examples with count outcomes<a class="anchor" aria-label="anchor" href="#additional-examples-with-count-outcomes"></a>
</h2>
<div class="section level3">
<h3 id="initial-predictor-method">Initial predictor method<a class="anchor" aria-label="anchor" href="#initial-predictor-method"></a>
</h3>
<p>If you choose two regressions or contrast regression as the scoring
method, there is an option to specify how the initial outcome regression
estimates (<span class="math inline">\(\hat\mu_r^k\)</span> where <span class="math inline">\(r = 0,1\)</span> is the treatment and <span class="math inline">\(k\)</span> is the CV fold) are calculated. See <a href="Theoretical-details.html">Theoretical details</a> section for the
background of these initial predictors and how they are used in two and
contrast regressions. Here is a list of all 3 options:</p>
<ul>
<li>“poisson” (Poisson regression from the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function)
<ul>
<li>generalized linear model, strong assumption on Poisson distribution,
fast</li>
</ul>
</li>
<li>“gbm” (gradient boosting machine from the <code>gbm</code> R
package)
<ul>
<li>ensemble method, typically tree-based, slow</li>
</ul>
</li>
<li>“gam” (generalized additive model from the <code>mgcv</code>
package)
<ul>
<li>a combination of generalized linear model and additive models where
the linear predictor is an additive function of the covariates, can be
slow</li>
</ul>
</li>
</ul>
<p>The main example above used a Poisson regression but you can try the
other 2 non-linear and more flexible options. Below, we use
<code><a href="../reference/catecvcount.html">catecvcount()</a></code> as the example code but this can be applied
to <code><a href="../reference/catefitcount.html">catefitcount()</a></code> as well.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An example of using GBM as the initial predictor method</span></span>
<span><span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>       data <span class="op">=</span> <span class="va">countExample</span>,</span>
<span>       score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"boosting"</span>, <span class="st">"twoReg"</span>, <span class="st">"contrastReg"</span>, <span class="st">"negBin"</span><span class="op">)</span>,</span>
<span>       cate.model <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_treatment</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>, </span>
<span>       higher.y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       initial.predictor.method <span class="op">=</span> <span class="st">"boosting"</span>,       <span class="co"># NEW</span></span>
<span>       cv.n <span class="op">=</span> <span class="fl">5</span>, </span>
<span>       seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>       plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># An example of using GAM as the initial predictor method</span></span>
<span><span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>       data <span class="op">=</span> <span class="va">countExample</span>,</span>
<span>       score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"boosting"</span>, <span class="st">"twoReg"</span>, <span class="st">"contrastReg"</span>, <span class="st">"negBin"</span><span class="op">)</span>,</span>
<span>       cate.model <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_treatment</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>, </span>
<span>       higher.y <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>       initial.predictor.method <span class="op">=</span> <span class="st">"gam"</span>,        <span class="co"># NEW</span></span>
<span>       xvar.smooth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"previous_cost"</span><span class="op">)</span>, <span class="co"># NEW</span></span>
<span>       cv.n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>       seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>       plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Note that for the GAM method, there is an additional argument called
<code>xvar.smooth</code>. If left as default (which is NULL), GAM will
include all independent variables in <code>cate.model</code> as smooth
terms with function <code>s()</code> in the linear predictor. You can
choose to specify only a subset of the dependent variables as the smooth
terms. In the example above, the specifications <code>cate.model</code>
and <code>xvar.smooth</code> lead to the following GAM formula:
<code>y ~ female + previous_treatment + previous_number_relapses + s(age) + s(previous_cost)</code>,
where only age and previous medical costs are wrapped in the smooth
function and the remaining 3 independent variables are not.</p>
<p>Generally speaking, the “poisson” initial predictor method is the
fastest and “gbm” is the slowest among the 3 methods, while “gam” is
somewhere in between with longer computational time as the number of
smooth terms increases.</p>
</div>
<div class="section level3">
<h3 id="subgroup-proportion">Subgroup proportion<a class="anchor" aria-label="anchor" href="#subgroup-proportion"></a>
</h3>
<p>The ATE by subgroups and validation curve results depend on how the
subgroups are defined, which is determined by the sorted CATE scores.
There could be nested binary subgroups (cutoffs specified by
<code>prop.cutoff</code>) or mutually exclusive subgroups (cutoffs
specified by <code>prop.multi</code>). In the main example above, we
used the default values of <code>prop.cutoff</code> and
<code>prop.multi</code> and we have provided explanations in the ATE
results. Here is a recap:</p>
<ul>
<li><p><code>prop.cutoff = seq(0.5, 1, length = 6)</code> means that we
have 6 sets of nested binary subgroups where the first subgroup splits
the sample by 50/50 according to the estimated CATE scores (sorted), the
2nd subgroup splits the sample by 60/40, …, the 5th subgroup splits the
sample by 90/10, and the 6th subgroup splits the sample by 100/0. The
validation curves show the ATE in the first group of each split, i.e.,
50%, 60%, 70%, …, 100%. The 6th subgroup is technically not a split but
we keep it because it is equivalent to the overall ATE (the gray dashed
reference line). The functions that use <code>prop.cutoff</code> will
automatically discard 0 if supplied because 0/100 split does not make
sense as there is no 0% subgroup to plot for the validation curves, and
a warning message will be given. The argument <code>higher.y</code>
controls the direction of the sorted CATE scores, i.e., whether we split
from the lowest or the highest CATE scores. For our toy example,
<code>higher.y</code> = FALSE so we split from the lowest CATE scores
such that the first group in each subgroup represents higher responders
to the treatment coded with 1.</p></li>
<li><p><code>prop.multi = c(0, 1/3, 2/3, 1)</code> means that we specify
a 3-category mutually exclusive subgroup, split by 33/33/33 according to
the estimated CATE scores. The argument <code>higher.y</code> controls
the direction of the sorted CATE scores, i.e., where we split from the
lowest or the highest CATE scores. For our toy example,
<code>higher.y</code> = FALSE so we split from the lowest CATE scores.
Contrary to <code>prop.cutoff</code>, <code>prop.multi</code> must
include both 0 and 1 to remind us of the mutual exclusiveness. he
functions that use <code>prop.multi</code> will automatically attach 0
and/or 1 if they are not supplied and a warning message will be given.
Now we show more examples of different cutoffs and how they are
reflected in the results.</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An example of 11 nested binary subgroups and a 4-category mutually exclusive subgroup</span></span>
<span><span class="va">output_catecv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">countExample</span>,</span>
<span>                         score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"contrastReg"</span>, <span class="st">"negBin"</span><span class="op">)</span>,</span>
<span>                         cate.model <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_treatment</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span>
<span>                         higher.y <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         prop.cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">11</span><span class="op">)</span>, <span class="co"># NEW</span></span>
<span>                         prop.multi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>,    <span class="co"># NEW</span></span>
<span>                         initial.predictor.method <span class="op">=</span> <span class="st">"poisson"</span>, </span>
<span>                         cv.n <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                         seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>                         plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in prop.multi == c(0, 1): longer object length is not a multiple of</span></span>
<span><span class="co">#&gt; shorter object length</span></span>
<span><span class="co">#&gt; Warning in data.preproc(fun = "crossv", cate.model = cate.model, ps.model = ps.model, : Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">$</span><span class="va">ate.contrastReg</span><span class="op">$</span><span class="va">ate.est.train.high.cv</span><span class="op">)</span> </span>
<span><span class="co">#&gt;                cv1       cv2       cv3       cv4       cv5</span></span>
<span><span class="co">#&gt; prop0.5  0.5915071 0.6428854 0.5744973 0.6406698 0.5924975</span></span>
<span><span class="co">#&gt; prop0.55 0.6139446 0.6935608 0.6003164 0.6519496 0.6531537</span></span>
<span><span class="co">#&gt; prop0.6  0.6722855 0.7114461 0.6591966 0.6871502 0.7186517</span></span>
<span><span class="co">#&gt; prop0.65 0.6958967 0.7839030 0.7306405 0.7265152 0.7519433</span></span>
<span><span class="co">#&gt; prop0.7  0.7371734 0.8399117 0.7806273 0.7779180 0.7539283</span></span>
<span><span class="co">#&gt; prop0.75 0.7795305 0.8320732 0.8003894 0.8266780 0.7999920</span></span>
<span><span class="co">#&gt; prop0.8  0.8034239 0.9082507 0.8218952 0.8269917 0.8117300</span></span>
<span><span class="co">#&gt; prop0.85 0.8585330 0.9649914 0.8763313 0.8949641 0.8512447</span></span>
<span><span class="co">#&gt; prop0.9  0.9027108 1.0257463 0.9595834 0.9049020 0.9452626</span></span>
<span><span class="co">#&gt; prop0.95 0.9607169 1.0002418 0.9968210 0.9784077 0.9816699</span></span>
<span><span class="co">#&gt; prop1    1.0599740 1.0520675 1.0577453 1.0641114 1.0677619</span></span>
<span><span class="co"># Dimension is now 11 rows (nested binary subgroups) by 5 columns (CV iterations)</span></span></code></pre></div>
<p>Because we have new <code>prop.cutoff</code> with 11 values as
opposed to only 6 in the original example, the number of rows in the ATE
results will be changed accordingly while the number of columns stays
the same because we still use 5 CV iterations.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/subgroup_proportion3_count-1.png" width="700"></p>
<p>The validation curves depend on <code>prop.cutoff</code> and are now
smoother than the one presented in the main example because they contain
10 subgroups instead of 5. The ABC statistic is not affected by the
change in <code>prop.cutoff</code> because the calculation of ABC
statistics depends on the minimum and maximum of the
<code>prop.cutoff</code> vector and is always calculated based on 100
evenly-spaced cutoffs created from this range. See more theoretical
details on ABC calculation in the <a href="Theoretical-details.html">Theoretical details</a> section.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">$</span><span class="va">ate.contrastReg</span><span class="op">$</span><span class="va">ate.est.train.group.cv</span><span class="op">)</span> </span>
<span><span class="co">#&gt;                cv1       cv2       cv3       cv4       cv5</span></span>
<span><span class="co">#&gt; prop0.25 1.8605588 1.7135347 1.8864599 1.6231411 1.8095445</span></span>
<span><span class="co">#&gt; prop0.5  1.2881059 1.3353842 1.3960644 1.4225390 1.3873281</span></span>
<span><span class="co">#&gt; prop0.75 0.8863431 1.0140060 0.8214955 1.0732422 0.8013989</span></span>
<span><span class="co">#&gt; prop1    0.4352059 0.3988016 0.4113767 0.4230607 0.4559544</span></span>
<span><span class="co"># Dimension is now 4 rows (multi-category mutually exclusive subgroups) by 5 columns (CV iterations)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/subgroup_proportion4_count-1.png" width="700"></p>
<p>For results on the mutually exclusive subgroups, the number of rows
in the ATE results increases from 3 to 4 in comparison with the original
example because <code>prop.multi</code> now defines 4 mutually exclusive
subgroups. For each method, the box plot now has 4 boxes for 4 mutually
exclusive subgroups.</p>
<p><strong>Examples that we do not recommend</strong></p>
<p>In this next example, <code>prop.cutoff</code> includes 0.01, which
is very close to 0. Consequently, the scoring methods may run into some
convergence issues because the first subgroup includes a small number of
patients. This can lead to highly unstable ATE estimates, as shown in
the first CV iteration of contrast regression in
<code>output_catecv3$ate.contrastReg$ate.est.valid.high.cv</code>.
Moreover, the validation curves become useless due to the extreme ATE
estimates.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># An example of very few nested binary subgroups</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>output_catecv3 <span class="ot">&lt;-</span> <span class="fu">catecv</span>(<span class="at">response =</span> <span class="st">"count"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> countExample,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">score.method =</span> <span class="fu">c</span>(<span class="st">"poisson"</span>, <span class="st">"contrastReg"</span>, <span class="st">"negBin"</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cate.model =</span> y <span class="sc">~</span> age <span class="sc">+</span> female <span class="sc">+</span> previous_treatment</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="sc">+</span> previous_cost <span class="sc">+</span> previous_number_relapses </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(years)),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ps.model =</span> trt <span class="sc">~</span> age <span class="sc">+</span> previous_treatment, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">initial.predictor.method =</span> <span class="st">"poisson"</span>, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">higher.y =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop.cutoff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>, <span class="fl">0.30</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="co"># NEW</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cv.n =</span> <span class="dv">5</span>, </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seed =</span> <span class="dv">999</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plot.gbmperf =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">verbose =</span> <span class="dv">1</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in data.preproc(fun = "crossv", cate.model = cate.model, ps.model = ps.model, : Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in data.preproc(fun = "crossv", cate.model = cate.model, ps.model =</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ps.model, : The first element of prop.cutoff cannot be 0 and has been removed.</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 1 </span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   convergence TRUE </span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:21:52 2023 </span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============</span>                                                        <span class="er">|</span>  <span class="dv">20</span>%</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 2 </span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   convergence TRUE </span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:21:57 2023 </span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================</span>                                          <span class="er">|</span>  <span class="dv">40</span>%</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 3 </span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   convergence TRUE </span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:22:05 2023 </span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================</span>                            <span class="er">|</span>  <span class="dv">60</span>%</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 4 </span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   convergence TRUE </span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:22:14 2023 </span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================================</span>              <span class="er">|</span>  <span class="dv">80</span>%</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 5 </span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   convergence TRUE </span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:22:23 2023 </span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total runtime : 42.9 secs</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>output_catecv3<span class="sc">$</span>ate.contrastReg<span class="sc">$</span>ate.est.valid.high.cv</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                cv1       cv2          cv3          cv4       cv5</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop0.01 0.5746485        NA 6.858623e+04 1.901224e+06        NA</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop0.3  0.6944399 0.6252387 6.104046e-01 5.625166e-01 0.5828618</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop0.75 1.1424118 0.8042944 8.929894e-01 7.984435e-01 0.8409132</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop1    1.0812603 1.0978549 1.053193e+00 1.072635e+00 1.0689638</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_catecv3</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/subgroup_proportion_bad2_count-1.png" width="700"></p>
<p>Below are some general recommendations on the choice of
<code>prop.cutoff</code> and <code>prop.multi</code>:</p>
<ol style="list-style-type: decimal">
<li>We do not recommend including 0 in <code>prop.cutoff</code> as it is
an invalid value. The functions will automatically remove 0 in
<code>prop.cutoff</code> and output a warning message.</li>
<li>We do not recommend choosing values too close to 0 either because
this will generate very small subgroups which may lead to numerical
instability, e.g., 1/99 split specified by 0.01 in this example and
corresponding ATE in the training data for contrast regression. In this
situation, either the validation curves will be dominated by the
unstable ATE estimates, making the plot useless as in this example, or
the validation curves will not be plotted if the numerical instability
due to an extreme split leads to missing values, in which case a warning
is printed as in the example above.</li>
<li>In general, we do not recommend specifying too few proportions for
<code>prop.cutoff</code> (e.g., 2 or 3) because the validation curves
will look jagged. The validation curves will be smoother with more
proportions spread out over the range of proportions. If computation is
an issue, however, choosing too many values for <code>prop.cutoff</code>
or <code>prop.multi</code> can be time consuming. It is recommended to
start from a smaller length and you can increase the length as
needed.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="additional-examples-for-survival-outcomes">Additional examples for survival outcomes<a class="anchor" aria-label="anchor" href="#additional-examples-for-survival-outcomes"></a>
</h2>
<div class="section level3">
<h3 id="initial-predictor-method-1">Initial predictor method<a class="anchor" aria-label="anchor" href="#initial-predictor-method-1"></a>
</h3>
<p>If you choose two and/or contrast regression as the scoring method,
there is an option to specify how the initial outcome regression
estimates (<span class="math inline">\(\hat\mu_r^k\)</span> where <span class="math inline">\(r = 0,1\)</span> is the treatment and <span class="math inline">\(k\)</span> is the cross validation fold) are
calculated. See <a href="Theoretical-details.html">Theoretical
details</a> section for the background of these initial predictors and
how they are used in the two and contrast regression. Here is a list of
all 3 options:</p>
<ul>
<li>“logistic” (logistic regression from the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>
function)
<ul>
<li>generalized linear model, strong assumption on binomial
distribution, fast</li>
</ul>
</li>
<li>“boosting” (gradient boosting machine from the <code>gbm</code> R
package)
<ul>
<li>ensemble method, typically tree-based, assume the time-to-event
outcome as Gaussian distributed, slow</li>
</ul>
</li>
<li>“randomForest” (random survival forest model from the
<code>randomForestSRC</code> package)
<ul>
<li>ensemble method, tree-based, non-parametric, can be slow</li>
</ul>
</li>
</ul>
<p>The main example above used a logistic regression but you can try the
other 2 non-linear and more flexible options. Below, we use
<code><a href="../reference/catecv.html">catecv()</a></code> as the example code but this can be applied to
<code><a href="../reference/catefit.html">catefit()</a></code> as well.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An example of using GBM as the initial predictor method</span></span>
<span><span class="va">tau0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">survivalExample</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"drug1"</span><span class="op">]</span>, <span class="fl">0.95</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"drug0"</span><span class="op">]</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>       data <span class="op">=</span> <span class="va">survivalExample</span>,</span>
<span>       score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"boosting"</span>, <span class="st">"randomForest"</span>, <span class="st">"twoReg"</span>, <span class="st">"contrastReg"</span><span class="op">)</span>,</span>
<span>       cate.model <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span>
<span>       ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span>
<span>       ipcw.model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       followup.time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       tau0 <span class="op">=</span> <span class="va">tau0</span>,</span>
<span>       surv.min <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>       higher.y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       prop.cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>       prop.multi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       cv.n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>       initial.predictor.method <span class="op">=</span> <span class="st">"boosting"</span>, <span class="co"># NEW</span></span>
<span>       tree.depth <span class="op">=</span> <span class="fl">3</span>,                        <span class="co"># NEW</span></span>
<span>       seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>       plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># An example of using random forest as the initial predictor method</span></span>
<span><span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>       data <span class="op">=</span> <span class="va">survivalExample</span>,</span>
<span>       score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"boosting"</span>, <span class="st">"randomForest"</span>, <span class="st">"twoReg"</span>, <span class="st">"contrastReg"</span><span class="op">)</span>,</span>
<span>       cate.model <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span>
<span>       ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span>
<span>       ipcw.model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       followup.time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       tau0 <span class="op">=</span> <span class="va">tau0</span>,</span>
<span>       surv.min <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>       higher.y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>       prop.cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>       prop.multi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>       cv.n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>       initial.predictor.method <span class="op">=</span> <span class="st">"randomForest"</span>, <span class="co"># NEW</span></span>
<span>       n.trees.rf <span class="op">=</span> <span class="fl">500</span>,                          <span class="co"># NEW</span></span>
<span>       seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>       plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>Note that for <code>boosting</code> and <code>randomForest</code>
methods that are tree-based, parameters such as tree depth and number of
trees can be specified with arguments <code>tree.depth</code>,
<code>n.trees.rf</code>, and <code>n.trees.boosting</code>.</p>
<p>Generally speaking, the “logistic” initial predictor method is the
fastest and “boosting” is the slowest among the 3 methods, while
“randomForest” is somewhere in between with longer computational time as
the number of trees and tree depth increase.</p>
</div>
<div class="section level3">
<h3 id="subgroup-proportion-1">Subgroup proportion<a class="anchor" aria-label="anchor" href="#subgroup-proportion-1"></a>
</h3>
<p>The <strong>precmed</strong> results depend on the subgroups which
are determined by the sorted CATE scores. There could be nested binary
subgroups (cutoffs specified by <code>prop.cutoff</code>) or mutually
exclusive subgroups (cutoffs specified by <code>prop.multi</code>). In
the main example above, we used certain values of
<code>prop.cutoff</code> and <code>prop.multi</code> and we have
provided explanations in the ATE results. Here is a recap:</p>
<ul>
<li><p><code>prop.cutoff = seq(0.6, 1, length = 5)</code> means that we
have 5 sets of nested binary subgroups where the first subgroup set is
split by 60/40 according to the estimated CATE scores (sorted), the 2nd
subgroup set is split by 70/30, …, and the 6th subgroup set is split by
100/0. The validation curves show results of the first group of each
split, i.e., 60%, 70%, …, 100%. The 5th subgroup set is technically not
a split but we keep it because it is equivalent to the overall ATE (the
gray dashed reference line). <strong>precmed</strong> will automatically
discard 0 if supplied because 0/100 split does not make sense as there
is no 0% subgroup to plot for the validation curves, and a warning
message will be given. Argument <code>higher.y</code> controls the
direction of the sorted CATE scores, i.e., whether we split from the
lowest or the highest CATE scores. For our toy example,
<code>higher.y</code> = TRUE so we split from the lowest CATE
scores.</p></li>
<li><p><code>prop.multi = c(0, 0.5, 0.6, 1)</code> means that we specify
a 3-category mutually exclusive subgroup, split by 50/10/40 according to
the estimated CATE scores. Argument <code>higher.y</code> controls the
direction of the sorted CATE scores, i.e., where we split from the
lowest or the highest CATE scores. For our toy example,
<code>higher.y</code> = TRUE so we split from the lowest CATE scores.
Contrary to <code>prop.cutoff</code>, <code>prop.multi</code> must
include both 0 and 1 to remind us of the mutual exclusiveness.
<strong>precmed</strong> will automatically attach 0 and/or 1 if they
are not supplied and a warning message will be given.</p></li>
</ul>
<p>Now we show more examples of different cutoffs and how they are
reflected in the results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An example of 9 nested binary subgroups and a 4-category mutually exclusive subgroup</span></span>
<span><span class="va">tau0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">survivalExample</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"drug1"</span><span class="op">]</span>, <span class="fl">0.95</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"drug0"</span><span class="op">]</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_catecv2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">survivalExample</span>,</span>
<span>                         score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"randomForest"</span>, <span class="st">"contrastReg"</span><span class="op">)</span>,</span>
<span>                         </span>
<span>                cate.model <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span></span>
<span>                                                        <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span>
<span>                ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span>
<span>                initial.predictor.method <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                ipcw.model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                followup.time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                tau0 <span class="op">=</span> <span class="va">tau0</span>,</span>
<span>                surv.min <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>                higher.y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                prop.cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>, <span class="co"># NEW</span></span>
<span>                prop.multi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>,   <span class="co"># NEW</span></span>
<span>                cv.n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>                plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in prop.multi == c(0, 1): longer object length is not a multiple of</span></span>
<span><span class="co">#&gt; shorter object length</span></span>
<span><span class="co">#&gt; Warning in data.preproc.surv(fun = "crossv", cate.model = cate.model, ps.model = ps.model, : Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">$</span><span class="va">ate.contrastReg</span><span class="op">$</span><span class="va">ate.est.train.high.cv</span><span class="op">)</span> </span>
<span><span class="co">#&gt;                cv1       cv2       cv3       cv4       cv5</span></span>
<span><span class="co">#&gt; prop0.6  0.5286488 0.5344877 0.5325352 0.5246205 0.5338395</span></span>
<span><span class="co">#&gt; prop0.65 0.5791944 0.5829187 0.6151744 0.5762170 0.5955160</span></span>
<span><span class="co">#&gt; prop0.7  0.6168472 0.6682790 0.6440506 0.6333903 0.6438643</span></span>
<span><span class="co">#&gt; prop0.75 0.7017728 0.7330868 0.7038570 0.6943269 0.7105475</span></span>
<span><span class="co">#&gt; prop0.8  0.7696228 0.8005505 0.7752939 0.7763984 0.7873444</span></span>
<span><span class="co">#&gt; prop0.85 0.8374886 0.8700290 0.8403268 0.8512221 0.8544261</span></span>
<span><span class="co">#&gt; prop0.9  0.9110024 0.9351850 0.9030097 0.9108305 0.9137251</span></span>
<span><span class="co">#&gt; prop0.95 0.9951218 1.0190440 0.9862585 0.9967722 0.9920313</span></span>
<span><span class="co">#&gt; prop1    1.0534514 1.1042633 1.0646558 1.0830122 1.0690691</span></span>
<span><span class="co"># Dimension is 9 (nested binary subgroups) by 5 (CV iterations)</span></span></code></pre></div>
<p>Because we have new <code>prop.cutoff</code> with 9 values as opposed
to only 5 in the original example, the number of rows in the ATE results
will be changed accordingly while the number of columns remains to be
5.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/subgroup_proportion3-1.png" width="700"></p>
<p>The validation curves depend on <code>prop.cutoff</code> and have
more line segments than the one presented in the main example because
they contain 9 sets of subgroups instead of 5 sets (although it is not
so obvious here in this example). The ABC statistic is not affected by
this because the calculation of ABC statistics depends on the minimum
and maximum of the <code>prop.cutoff</code> vector and 100 evenly-spaced
subgroup cutoffs are created from this range. The highest proportion
cutoff that is not 1 in the main example was 0.9 and it is now 0.95. See
more theoretical details on ABC calculation in the <a href="Theoretical-details.html">Theoretical details</a> section.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">$</span><span class="va">ate.contrastReg</span><span class="op">$</span><span class="va">ate.est.train.group.cv</span><span class="op">)</span> </span>
<span><span class="co">#&gt;               cv1       cv2       cv3       cv4      cv5</span></span>
<span><span class="co">#&gt; prop0.4 6.2068924 6.6101517 6.7424201 6.5030289 7.027033</span></span>
<span><span class="co">#&gt; prop0.5 1.4458427 1.4142659 1.4728371 1.4372399 1.381593</span></span>
<span><span class="co">#&gt; prop0.6 0.9080483 1.2062367 1.0115264 0.9270653 1.259874</span></span>
<span><span class="co">#&gt; prop1   0.3746892 0.4068091 0.3454113 0.3465889 0.377679</span></span>
<span><span class="co"># Dimension is now 4 (multi-category mutually exclusive subgroups) by 3 (CV iterations)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">output_catecv2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing non-finite values (`stat_boxplot()`).</span></span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/subgroup_proportion4-1.png" width="700"></p>
<p>For results on the mutually exclusive subgroups, the number of rows
in the ATE results increases from 3 to 4 in comparison with the original
example because <code>prop.multi</code> now defines 4 mutually exclusive
subgroups. For each methods, the box plot now has 4 boxes for 4 mutually
exclusive subgroups.</p>
<p><strong>Examples that we do not recommend</strong></p>
<p>In this example, <code>prop.cutoff</code> includes 0.01, which is
very close to 0. Consequently, the scoring methods may run into some
convergence issues because the first subgroup includes a small number of
patients. This can lead to highly unstable ATE estimates, as shown in
the first CV iteration of contrast regression in
<code>output_catecv3$ate.contrastReg$ate.est.valid.high.cv</code>.
Moreover, the validation curves become useless due to the extreme ATE
estimates.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># An example of very few nested binary subgroups</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>output_catecv3 <span class="ot">&lt;-</span> <span class="fu">catecv</span>(<span class="at">response =</span> <span class="st">"survival"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> survivalExample,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">score.method =</span> <span class="fu">c</span>(<span class="st">"contrastReg"</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cate.model =</span> survival<span class="sc">::</span><span class="fu">Surv</span>(y, d) <span class="sc">~</span> age <span class="sc">+</span> female <span class="sc">+</span> previous_cost <span class="sc">+</span> previous_number_relapses,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ps.model =</span> trt <span class="sc">~</span> age <span class="sc">+</span> previous_treatment,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">initial.predictor.method =</span> <span class="st">"logistic"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ipcw.model =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">followup.time =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tau0 =</span> tau0,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">surv.min =</span> <span class="fl">0.025</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">higher.y =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop.cutoff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.75</span>, <span class="dv">1</span>), <span class="co"># NEW</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prop.multi =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="dv">1</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cv.n =</span> <span class="dv">5</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seed =</span> <span class="dv">999</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">plot.gbmperf =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">verbose =</span> <span class="dv">1</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in data.preproc.surv(fun = "crossv", cate.model = cate.model, ps.model = ps.model, : Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning in data.preproc.surv(fun = "crossv", cate.model = cate.model, ps.model</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; = ps.model, : The first element of prop.cutoff cannot be 0 and has been</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; removed.</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="er">|</span>                                                                      <span class="er">|</span>   <span class="dv">0</span>%</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 1 </span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Contrast regression converged.</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:24:52 2023 </span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==============</span>                                                        <span class="er">|</span>  <span class="dv">20</span>%</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 2 </span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Contrast regression converged.</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:24:59 2023 </span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>  <span class="er">|============================</span>                                          <span class="er">|</span>  <span class="dv">40</span>%</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 3 </span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Contrast regression converged.</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:25:05 2023 </span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  <span class="er">|==========================================</span>                            <span class="er">|</span>  <span class="dv">60</span>%</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 4 </span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Contrast regression converged.</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:25:11 2023 </span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>  <span class="er">|========================================================</span>              <span class="er">|</span>  <span class="dv">80</span>%</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; cv = 5 </span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   splitting the data..</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   training..</span></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   validating..</span></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Contrast regression converged.</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Thu May 11 10:25:18 2023 </span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|</span>                                                                            </span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  <span class="er">|======================================================================|</span> <span class="dv">100</span>%</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Total runtime : 31.83 secs</span></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>output_catecv3<span class="sc">$</span>ate.contrastReg<span class="sc">$</span>ate.est.valid.high.cv</span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                cv1       cv2       cv3       cv4       cv5</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop0.1         NA        NA        NA        NA        NA</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop0.75 0.7251659 0.5735622 0.9376515 0.6359857 0.7093587</span></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; prop1    1.1465914 1.0179736 1.1351233 1.0311785 1.1141329</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_catecv3</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/subgroup_proportion_bad2-1.png" width="700"></p>
<p>Below are some general recommendations on the choice of
<code>prop.cutoff</code> and <code>prop.multi</code>:</p>
<ol style="list-style-type: decimal">
<li>We do not recommend including 0 in <code>prop.cutoff</code> as it is
an invalid value. <strong>precmed</strong> automatically removes 0 in
<code>prop.cutoff</code> and outputs a warning message.</li>
<li>We do not recommend choosing values too close to 0 either because
this will generate very small subgroups which may lead to numerical
instability, e.g., 10/90 split specified by 0.1 in this example. In this
situation, either the validation curves will be plotted by the range of
the unstable ATE estimates will make them useless or the validation
curves will not be plotted if the numerical instability due to an
extreme split leads to missing or infinite values, in which case a
warning or error is printed as in the example above.</li>
<li>In general, we do not recommend specifying too few proportions for
<code>prop.cutoff</code> (e.g., 2 or 3) because the validation curves
will look very jagged. The validation curves will be smoother with more
proportions and more spread out over the range of proportions. If
computation is an issue, however, choosing too many values for
<code>prop.cutoff</code> or <code>prop.multi</code> can be time
consuming. It is recommended to start from a smaller length and you can
increase the length as needed.</li>
</ol>
</div>
<div class="section level3">
<h3 id="ipcw-model-and-method">IPCW model and method<a class="anchor" aria-label="anchor" href="#ipcw-model-and-method"></a>
</h3>
<p>The default IPCW model uses the same covariates as the outcome model
<code>cate.model</code> plus the treatment. The default IPCW method is a
Cox regression with Breslow estimator of the baseline survivor function
from <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> function in the <code>survival</code> package.
Different variables or different method can be specified in the IPCW
model. In the example below, we changed the covariates to the number of
symptoms and number relapses in the pre-index period and specified the
Weibull accelerated failure time (AFT) regression model using the
location-scale parameterization. The <code><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survreg()</a></code> function in
the <code>survival</code> package was used to fit the AFT model.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An example of a different IPCW model with different covariates from default</span></span>
<span><span class="va">output_catecv4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">survivalExample</span>,</span>
<span>                         score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"contrastReg"</span><span class="op">)</span>,</span>
<span>                         cate.model <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span>
<span>                         ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span>
<span>                         initial.predictor.method <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                         ipcw.model <span class="op">=</span> <span class="op">~</span> <span class="va">previous_number_symptoms</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>, <span class="co"># NEW</span></span>
<span>                         ipcw.method <span class="op">=</span> <span class="st">"aft (weibull)"</span>, <span class="co"># NEW</span></span>
<span>                         followup.time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                         tau0 <span class="op">=</span> <span class="va">tau0</span>,</span>
<span>                         surv.min <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>                         higher.y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         prop.cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span>
<span>                         prop.multi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         cv.n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                         seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>                         plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="truncation-and-follow-up-time">Truncation and follow-up time<a class="anchor" aria-label="anchor" href="#truncation-and-follow-up-time"></a>
</h3>
<p>The argument <code>tau0</code> specifies the truncation time for
RMTL. The default is the maximum survival time in the data but it can be
changed if you have a specific truncation time in mind. Similarly, the
maximum follow-up time argument <code>followup.time</code> can be
changed from the default, which is unknown potential censoring time. The
study setup usually can shed some light on what values to use for these
two time parameters.</p>
<p>In the main example, we used the minimum of the 95th percentile of
survival time in either treatment group as <code>tau0</code>. Below we
show how setting different values of the truncation time.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An example of a different IPCW model with different covariates from default</span></span>
<span><span class="va">output_catecv5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/catecv.html">catecv</a></span><span class="op">(</span>response <span class="op">=</span> <span class="st">"survival"</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">survivalExample</span>,</span>
<span>                         score.method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poisson"</span>, <span class="st">"contrastReg"</span><span class="op">)</span>,</span>
<span>                         cate.model <span class="op">=</span> <span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span>
<span>                         ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span>
<span>                         initial.predictor.method <span class="op">=</span> <span class="st">"logistic"</span>,</span>
<span>                         ipcw.model <span class="op">=</span> <span class="op">~</span> <span class="va">previous_number_symptoms</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span>
<span>                         ipcw.method <span class="op">=</span> <span class="st">"aft (weibull)"</span>,</span>
<span>                         followup.time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                         tau0 <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># NEW</span></span>
<span>                         higher.y <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                         cv.n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                         surv.min <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>                         prop.cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">1</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>                         prop.multi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         seed <span class="op">=</span> <span class="fl">999</span>,</span>
<span>                         plot.gbmperf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                         verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in data.preproc.surv(fun = "crossv", cate.model = cate.model, ps.model</span></span>
<span><span class="co">#&gt; = ps.model, : No value supplied for tau0. Default sets tau0 to the maximum</span></span>
<span><span class="co">#&gt; survival time.</span></span>
<span><span class="co">#&gt; Warning in data.preproc.surv(fun = "crossv", cate.model = cate.model, ps.model = ps.model, : Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output_catecv5</span><span class="op">)</span></span></code></pre></div>
<p><img src="Additional-examples_files/figure-html/time-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="other-precmed-vignettes-in-this-serie">Other <code>precmed</code> vignettes in this serie<a class="anchor" aria-label="anchor" href="#other-precmed-vignettes-in-this-serie"></a>
</h2>
<p><a href="Count-examples.html">1. Examples for count outcome</a><br><a href="Survival-examples.html">2. Examples for survival
outcome</a><br><a href="Additional-examples.html">3. Additional examples</a><br><a href="Theoretical-details.html">4. Theoretical details</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lu Tian, Xiaotong Jiang, Gabrielle Simoneau, Thomas Debray.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
