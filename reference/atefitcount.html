<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Doubly robust estimator of and inference for the average treatment effect for count data — atefitcount • precmed</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Doubly robust estimator of and inference for the average treatment effect for count data — atefitcount"><meta name="description" content="Doubly robust estimator of the average treatment effect between two
treatments, which is the rate ratio for count outcomes. Bootstrap is used for
inference."><meta property="og:description" content="Doubly robust estimator of the average treatment effect between two
treatments, which is the rate ratio for count outcomes. Bootstrap is used for
inference."><meta property="og:image" content="https://smartdata-analysis-and-statistics.github.io/precmed/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">precmed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/Count-examples.html">Example with count outcome</a></li>
    <li><a class="dropdown-item" href="../articles/Survival-examples.html">Example with survival outcome</a></li>
    <li><a class="dropdown-item" href="../articles/Additional-examples.html">Additional examples</a></li>
    <li><a class="dropdown-item" href="../articles/Theoretical-details.html">Theoretical details</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/smartdata-analysis-and-statistics/precmed"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Doubly robust estimator of and inference for the average treatment effect for count data</h1>
      <small class="dont-index">Source: <a href="https://github.com/smartdata-analysis-and-statistics/precmed/blob/main/R/ATE_count.R" class="external-link"><code>R/ATE_count.R</code></a></small>
      <div class="d-none name"><code>atefitcount.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Doubly robust estimator of the average treatment effect between two
treatments, which is the rate ratio for count outcomes. Bootstrap is used for
inference.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">atefitcount</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">cate.model</span>,</span>
<span>  <span class="va">ps.model</span>,</span>
<span>  ps.method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  minPS <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  maxPS <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  interactions <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n.boot <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame containing the variables in the outcome, propensity
score, and inverse probability of censoring models (if specified); a data
frame with <code>n</code> rows (1 row per observation).</p></dd>


<dt id="arg-cate-model">cate.model<a class="anchor" aria-label="anchor" href="#arg-cate-model"></a></dt>
<dd><p>A formula describing the outcome model to be fitted.
The outcome must appear on the left-hand side.</p></dd>


<dt id="arg-ps-model">ps.model<a class="anchor" aria-label="anchor" href="#arg-ps-model"></a></dt>
<dd><p>A formula describing the propensity score (PS) model to be
fitted. The treatment must appear on the left-hand side. The treatment must
be a numeric vector coded as 0 or 1. If data are from a randomized controlled
trial, specify <code>ps.model = ~1</code> as an intercept-only model.</p></dd>


<dt id="arg-ps-method">ps.method<a class="anchor" aria-label="anchor" href="#arg-ps-method"></a></dt>
<dd><p>A character value for the method to estimate the propensity
score. Allowed values include one of: <code>'glm'</code> for logistic regression
with main effects only (default), or <code>'lasso'</code> for a logistic regression
with main effects and LASSO penalization on two-way interactions (added to
the model if interactions are not specified in <code>ps.model</code>). Relevant
only when <code>ps.model</code> has more than one variable.</p></dd>


<dt id="arg-minps">minPS<a class="anchor" aria-label="anchor" href="#arg-minps"></a></dt>
<dd><p>A numerical value between 0 and 1 below which estimated
propensity scores should be truncated. Default is <code>0.01</code>.</p></dd>


<dt id="arg-maxps">maxPS<a class="anchor" aria-label="anchor" href="#arg-maxps"></a></dt>
<dd><p>A numerical value between 0 and 1 above which estimated
propensity scores should be truncated. Must be strictly greater than
<code>minPS</code>. Default is <code>0.99</code>.</p></dd>


<dt id="arg-interactions">interactions<a class="anchor" aria-label="anchor" href="#arg-interactions"></a></dt>
<dd><p>A logical value indicating whether the outcome model
should assume treatment-covariate interaction by <code>x</code>. If <code>TRUE</code>,
interactions will be assumed only if at least 10 patients received each
treatment option. Default is <code>TRUE</code>.</p></dd>


<dt id="arg-n-boot">n.boot<a class="anchor" aria-label="anchor" href="#arg-n-boot"></a></dt>
<dd><p>A numeric value indicating the number of bootstrap samples
used. Default is <code>500</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional integer specifying an initial randomization seed for
reproducibility. Default is <code>NULL</code>, corresponding to no seed.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>An integer value indicating whether intermediate progress
messages should be printed. <code>1</code> indicates messages are printed and
<code>0</code> otherwise. Default is <code>0</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Return an item of the class <code>atefit</code> with the following
elements:</p><ul><li><p><code>log.rate.ratio</code>:  A vector of numeric values of the estimated
  ATE (expressed as a log rate ratio of <code>trt=1</code> over <code>trt=0</code>),
  the bootstrap standard error, the lower and upper limits of 95% confidence
  interval, and the p-value.</p></li>
<li><p><code>rate0</code>:  A numeric value of the estimated rate in the group
  <code>trt=0</code>.</p></li>
<li><p><code>rate1</code>:  A numeric value of the estimated rate in the group
  <code>trt=1</code>.</p></li>
<li><p><code>trt.boot</code>:  Estimated log rate ratios in each bootstrap
  sample.</p></li>
<li><p><code>warning</code>:  A warning message produced if the treatment
  variable was not coded as 0 or 1. The key to map the original coding of the
  variable to a 0-1 coding is displayed in the warning to facilitate the
  interpretation of the remaining of the output.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This helper function estimates the average treatment effect (ATE)
between two treatment groups in a given dataset. The ATE is estimated with a
doubly robust estimator that accounts for imbalances in covariate
distributions between the two treatment groups with inverse probability
treatment weighting. For count outcomes, the estimated ATE is the estimated
rate ratio between treatment 1 versus treatment 0.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">atefitcount</span><span class="op">(</span>data <span class="op">=</span> <span class="va">countExample</span>,</span></span>
<span class="r-in"><span>                      cate.model <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span> <span class="va">previous_treatment</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                   <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                   <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">years</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span></span>
<span class="r-in"><span>                      verbose <span class="op">=</span> <span class="fl">1</span>, n.boot <span class="op">=</span> <span class="fl">50</span>, seed <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   2%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   6%  |                                                                              |======                                                                |   8%  |                                                                              |=======                                                               |  10%  |                                                                              |=========                                                             |  12%  |                                                                              |==========                                                            |  14%  |                                                                              |===========                                                           |  16%  |                                                                              |=============                                                         |  18%  |                                                                              |==============                                                        |  20%  |                                                                              |================                                                      |  22%  |                                                                              |=================                                                     |  24%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  31%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  35%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  39%  |                                                                              |=============================                                         |  41%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  45%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  49%  |                                                                              |====================================                                  |  51%  |                                                                              |=====================================                                 |  53%  |                                                                              |=======================================                               |  55%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  59%  |                                                                              |===========================================                           |  61%  |                                                                              |============================================                          |  63%  |                                                                              |==============================================                        |  65%  |                                                                              |===============================================                       |  67%  |                                                                              |=================================================                     |  69%  |                                                                              |==================================================                    |  71%  |                                                                              |===================================================                   |  73%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  78%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  82%  |                                                                              |===========================================================           |  84%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  88%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  92%  |                                                                              |==================================================================    |  94%  |                                                                              |===================================================================   |  96%  |                                                                              |===================================================================== |  98%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span><span class="va">output</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average treatment effect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                  estimate        SE   CI.lower  CI.upper    pvalue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log.rate.ratio 0.06311746 0.1624482 -0.2552752 0.3815101 0.6976173</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated event rates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rate1 0.2860635</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rate0 0.2685660</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="atefitcount-1.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lu Tian, Xiaotong Jiang, Gabrielle Simoneau, Thomas Debray.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

