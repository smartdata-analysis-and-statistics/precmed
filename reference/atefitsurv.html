<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Doubly robust estimator of and inference for the average treatment effect for survival data — atefitsurv • precmed</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Doubly robust estimator of and inference for the average treatment effect for survival data — atefitsurv"><meta name="description" content="Doubly robust estimator of the average treatment effect between two treatments, which is the
restricted mean time lost ratio for survival outcomes. Bootstrap is used for inference."><meta property="og:description" content="Doubly robust estimator of the average treatment effect between two treatments, which is the
restricted mean time lost ratio for survival outcomes. Bootstrap is used for inference."><meta property="og:image" content="https://smartdata-analysis-and-statistics.github.io/precmed/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">precmed</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/Count-examples.html">Example with count outcome</a></li>
    <li><a class="dropdown-item" href="../articles/Survival-examples.html">Example with survival outcome</a></li>
    <li><a class="dropdown-item" href="../articles/Additional-examples.html">Additional examples</a></li>
    <li><a class="dropdown-item" href="../articles/Theoretical-details.html">Theoretical details</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/smartdata-analysis-and-statistics/precmed"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Doubly robust estimator of and inference for the average treatment effect for survival data</h1>
      <small class="dont-index">Source: <a href="https://github.com/smartdata-analysis-and-statistics/precmed/blob/main/R/ATE_surv.R" class="external-link"><code>R/ATE_surv.R</code></a></small>
      <div class="d-none name"><code>atefitsurv.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Doubly robust estimator of the average treatment effect between two treatments, which is the
restricted mean time lost ratio for survival outcomes. Bootstrap is used for inference.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">atefitsurv</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">cate.model</span>,</span>
<span>  <span class="va">ps.model</span>,</span>
<span>  ps.method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  ipcw.model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ipcw.method <span class="op">=</span> <span class="st">"breslow"</span>,</span>
<span>  minPS <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  maxPS <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>  followup.time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tau0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  surv.min <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  n.boot <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame containing the variables in the outcome, propensity score, and inverse
probability of censoring models (if specified); a data frame with <code>n</code> rows (1 row per observation).</p></dd>


<dt id="arg-cate-model">cate.model<a class="anchor" aria-label="anchor" href="#arg-cate-model"></a></dt>
<dd><p>A formula describing the outcome model to be fitted.
The outcome must appear on the left-hand side. For survival outcomes, a <code>Surv</code> object
must be used to describe the outcome.</p></dd>


<dt id="arg-ps-model">ps.model<a class="anchor" aria-label="anchor" href="#arg-ps-model"></a></dt>
<dd><p>A formula describing the propensity score (PS) model to be fitted. The treatment must
appear on the left-hand side. The treatment must be a numeric vector coded as 0/1.
If data are from a randomized controlled trial, specify <code>ps.model = ~1</code> as an intercept-only model.</p></dd>


<dt id="arg-ps-method">ps.method<a class="anchor" aria-label="anchor" href="#arg-ps-method"></a></dt>
<dd><p>A character value for the method to estimate the propensity score.
Allowed values include one of:
<code>'glm'</code> for logistic regression with main effects only (default), or
<code>'lasso'</code> for a logistic regression with main effects and LASSO penalization on
two-way interactions (added to the model if interactions are not specified in <code>ps.model</code>).
Relevant only when <code>ps.model</code> has more than one variable.</p></dd>


<dt id="arg-ipcw-model">ipcw.model<a class="anchor" aria-label="anchor" href="#arg-ipcw-model"></a></dt>
<dd><p>A formula describing the inverse probability of censoring weighting (IPCW)
model to be fitted. The left-hand side must be empty. Only applies for survival outcomes.
Default is <code>NULL</code>, which corresponds to specifying the IPCW with the same covariates
as the outcome model <code>cate.model</code>, plus the treatment.</p></dd>


<dt id="arg-ipcw-method">ipcw.method<a class="anchor" aria-label="anchor" href="#arg-ipcw-method"></a></dt>
<dd><p>A character value for the censoring model. Only applies for survival
outcomes. Allowed values are: <code>'breslow'</code> (Cox regression with Breslow estimator of t
he baseline survivor function), <code>'aft (exponential)'</code>, <code>'aft (weibull)'</code>,
<code>'aft (lognormal)'</code> or <code>'aft (loglogistic)'</code> (accelerated failure time model
with different distributions for y variable). Default is <code>'breslow'</code>.</p></dd>


<dt id="arg-minps">minPS<a class="anchor" aria-label="anchor" href="#arg-minps"></a></dt>
<dd><p>A numerical value (in `[0, 1]`) below which estimated propensity scores should be
truncated. Default is <code>0.01</code>.</p></dd>


<dt id="arg-maxps">maxPS<a class="anchor" aria-label="anchor" href="#arg-maxps"></a></dt>
<dd><p>A numerical value (in `(0, 1]`) above which estimated propensity scores should be
truncated. Must be strictly greater than <code>minPS</code>. Default is <code>0.99</code>.</p></dd>


<dt id="arg-followup-time">followup.time<a class="anchor" aria-label="anchor" href="#arg-followup-time"></a></dt>
<dd><p>A column name in <code>data</code> specifying the maximum follow-up time,
interpreted as the potential censoring time. Only applies for survival outcomes.
Default is <code>NULL</code>, which corresponds to unknown potential censoring time.</p></dd>


<dt id="arg-tau-">tau0<a class="anchor" aria-label="anchor" href="#arg-tau-"></a></dt>
<dd><p>The truncation time for defining restricted mean time lost. Only applies for
survival outcomes. Default is <code>NULL</code>, which corresponds to setting the truncation time as the
maximum survival time in the data.</p></dd>


<dt id="arg-surv-min">surv.min<a class="anchor" aria-label="anchor" href="#arg-surv-min"></a></dt>
<dd><p>Lower truncation limit for the probability of being censored.
It must be a positive value and should be chosen close to 0. Only applies for survival
outcomes. Default is <code>0.025</code>.</p></dd>


<dt id="arg-n-boot">n.boot<a class="anchor" aria-label="anchor" href="#arg-n-boot"></a></dt>
<dd><p>A numeric value indicating the number of bootstrap samples used. Default is <code>500</code>.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>An optional integer specifying an initial randomization seed for reproducibility.
Default is <code>NULL</code>, corresponding to no seed.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>An integer value indicating whether intermediate progress messages should
be printed. <code>1</code> indicates messages are printed and <code>0</code> otherwise. Default is <code>0</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Return an object of class <code>atefit</code> with 6 elements:</p><ul><li><p><code>rmst1</code>:  A vector of numeric values of the estimated RMST, bootstrap standard error,
  lower and upper limits of 95% confidence interval, and the p-value in the group <code>trt=1</code>.</p></li>
<li><p><code>rmst0</code>:  A vector of numeric values of the estimated RMST, bootstrap standard error,
  lower and upper limits of 95% confidence interval, and the p-value in the group <code>trt=0</code>.</p></li>
<li><p><code>log.rmtl.ratio</code>:  A vector of numeric values of the estimated log RMTL ratio of
  <code>trt=1</code> over <code>trt=0</code>, bootstrap standard error, lower and upper limits of 95% confidence
  interval, and the p-value.</p></li>
<li><p><code>log.hazard.ratio</code>:  A vector of numeric values of the estimated adjusted log hazard ratio
  of <code>trt=1</code> over <code>trt=0</code>, bootstrap standard error, lower and upper limits of 95% confidence
  interval, and the p-value.</p></li>
<li><p><code>trt.boot</code>:  Estimates of <code>rmst1</code>, <code>rmst0</code>,
  <code>log.rmtl.ratio</code> and <code>log.hazard.ratio</code> in each bootstrap sample.</p></li>
<li><p><code>warning</code>:  A warning message produced if the treatment variable was not coded as 0/1.
  The key to map the original coding of the variable to a 0/1 key is displayed in the warning to facilitate
  the interpretation of the remaining of the output.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This helper function estimates the average treatment effect (ATE) for survival data between two
treatment groups in a given dataset. The ATE is estimated with a doubly robust estimator that accounts for
imbalances in covariate distributions between the two treatment groups with inverse probability treatment and
censoring weighting. For survival outcomes, the estimated ATE is the estimated by RMTL ratio between treatment
1 versus treatment 0. The log-transformed ATEs and log-transformed adjusted hazard ratios are returned, as well
as the estimated RMST in either treatment group. The variability of the estimated RMTL ratio is calculated
using bootstrap. Additional outputs include standard error of the log RMTL ratio, 95% confidence interval,
p-value, and a histogram of the bootstrap estimates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tau0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">survivalExample</span>,</span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"drug1"</span><span class="op">]</span>, <span class="fl">0.95</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">trt</span> <span class="op">==</span> <span class="st">"drug0"</span><span class="op">]</span>, <span class="fl">0.95</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">atefitsurv</span><span class="op">(</span>data <span class="op">=</span> <span class="va">survivalExample</span>,</span></span>
<span class="r-in"><span>                     cate.model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">d</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">female</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                  <span class="va">previous_cost</span> <span class="op">+</span> <span class="va">previous_number_relapses</span>,</span></span>
<span class="r-in"><span>                     ps.model <span class="op">=</span> <span class="va">trt</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">previous_treatment</span>,</span></span>
<span class="r-in"><span>                     tau0 <span class="op">=</span> <span class="va">tau0</span>,</span></span>
<span class="r-in"><span>                     n.boot <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                     seed <span class="op">=</span> <span class="fl">999</span>,</span></span>
<span class="r-in"><span>                     verbose <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |=                                                                     |   2%  |                                                                              |===                                                                   |   4%  |                                                                              |====                                                                  |   6%  |                                                                              |======                                                                |   8%  |                                                                              |=======                                                               |  10%  |                                                                              |=========                                                             |  12%  |                                                                              |==========                                                            |  14%  |                                                                              |===========                                                           |  16%  |                                                                              |=============                                                         |  18%  |                                                                              |==============                                                        |  20%  |                                                                              |================                                                      |  22%  |                                                                              |=================                                                     |  24%  |                                                                              |===================                                                   |  27%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  31%  |                                                                              |=======================                                               |  33%  |                                                                              |========================                                              |  35%  |                                                                              |==========================                                            |  37%  |                                                                              |===========================                                           |  39%  |                                                                              |=============================                                         |  41%  |                                                                              |==============================                                        |  43%  |                                                                              |===============================                                       |  45%  |                                                                              |=================================                                     |  47%  |                                                                              |==================================                                    |  49%  |                                                                              |====================================                                  |  51%  |                                                                              |=====================================                                 |  53%  |                                                                              |=======================================                               |  55%  |                                                                              |========================================                              |  57%  |                                                                              |=========================================                             |  59%  |                                                                              |===========================================                           |  61%  |                                                                              |============================================                          |  63%  |                                                                              |==============================================                        |  65%  |                                                                              |===============================================                       |  67%  |                                                                              |=================================================                     |  69%  |                                                                              |==================================================                    |  71%  |                                                                              |===================================================                   |  73%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  78%  |                                                                              |========================================================              |  80%  |                                                                              |=========================================================             |  82%  |                                                                              |===========================================================           |  84%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  88%  |                                                                              |===============================================================       |  90%  |                                                                              |================================================================      |  92%  |                                                                              |==================================================================    |  94%  |                                                                              |===================================================================   |  96%  |                                                                              |===================================================================== |  98%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span><span class="va">output</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average treatment effect:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   estimate         SE    CI.lower  CI.upper     pvalue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log.rmtl.ratio   0.0701553 0.03206484 0.007309376 0.1330012 0.02867542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log.hazard.ratio 2.7133243 0.20897752 2.303735883 3.1229127 0.00000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimated RMST:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       estimate       SE CI.lower CI.upper pvalue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rmst1 172.8609 6.271374 160.5692 185.1526      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rmst0 196.5603 7.753894 181.3629 211.7576      0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Variable trt was recoded to 0/1 with drug0-&gt;0 and drug1-&gt;1.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="atefitsurv-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lu Tian, Xiaotong Jiang, Gabrielle Simoneau, Thomas Debray.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

